---
- name: Build Nuxt.js image
  hosts: all
  gather_facts: false
  vars:
    ansible_python_interpreter: /usr/bin/python3
    ansible_bender:
      base_image: "localhost/node-python3"
      ansible_extra_args: "-vvv"
 
      target_image:
        name: yuta28/bender-test
        working_dir: /app
        environment: 
          NUXT_HOST: 0.0.0.0
          # environment: NUXT_TELEMETRY_DISABLED=1
        labels:
          built-by: '{{ ansible_user }}'
          #   cmd: "yarn run dev"        

  tasks:
  - name: Copy Prototype parts
    copy:
      src: "{{ item }}"
      dest: /app/
    with_items:
      - "{{ playbook_dir }}/Prototype/app/package.json"
      - "{{ playbook_dir }}/Prototype/app/yarn.lock"
  
        #  - name: Yarn install
        #    command: "yarn install"

  - name: Upload Prototype to S3
    aws_s3:
      bucket: ansible-bender-bucket
      object: app/nuxt.config.js
      src: "{{ playbook_dir }}/Prototype/app/nuxt.config.js"
      mode: put

    #  - name: Copy Prototype
    #    copy:
    #      src: "{{ playbook_dir }}/Prototype/app" 
    #  dest: /app
 
